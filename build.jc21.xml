<?xml version="1.0" encoding="UTF-8"?>
<project name="build-jc21" default="convert" basedir=".">
    
	<import file="build.properties.xml"/>
	<import file="build.dateinfo.xml"/>
	
	<property name="jdk.java"  value="${jdk8.java}"/>
	<property name="jdk.javac" value="${jdk8.javac}"/>
	
	
	<!-- Compile target using exec form -->
    <target name="compile" depends="generate-info-file">
	    <echo message="compile ${jc21.sdk}..." />
		
        <!-- Create output directory -->
        <mkdir dir="${output.dir}/jc21"/>

        <!-- Compile JavaCard source files -->
        <exec executable="javac" failonerror="true">
            <arg value="-source"/><arg value="1.2"/>
            <arg value="-target"/><arg value="1.1"/>
            <arg value="-d"/><arg value="${output.dir}/jc21"/>
            <arg value="-classpath"/>
            <arg value="${jc21.sdk}/lib/api21.jar;${output.dir}/jc21;${gpapi.jar}"/>
            <arg value="${src.dir}/${package.name}/*.java"/>
        </exec>
    </target>
	
	<!-- Convert target using exec form -->
    <target name="convert" depends="compile">
	    <echo message="convert ${jc21.sdk}..." />
		
	    <!-- Run JavaCard converter using specific JDK -->
        <exec executable="${jdk11.java}" failonerror="true">

			<!-- Set JVM property jc.home -->
			<arg value="-Djc.home=${jc21.sdk}"/>
			
			<!-- Set classpath to include JavaCard converter tool -->
			<arg value="-cp"/>
			<arg value="${jc21.sdk}/lib/converter.jar"/>
			
			<!-- Main class to run -->
			<arg value="com.sun.javacard.converter.Converter"/>

			<!-- Specify export path -->
			<arg value="-exportpath"/>
			<arg value="${jc21.sdk}/api_export_files"/>


			<!-- Output formats -->
            <arg value="-out"/>
            <arg value="JCA"/>
            <arg value="CAP"/>
            <arg value="EXP"/>
			
			<!-- Compiled class files directory -->
            <arg value="-classdir"/>
            <arg value="${output.dir}/jc21"/>

			<!-- Output directory for generated files -->
            <arg value="-d"/>
            <arg value="${output.dir}/jc21"/>
			
			<!-- support int -->
            <arg value="-i"/>
			
			<!-- Applet information -->
            <arg value="-applet"/>
            <arg value="${package.aid.ant}"/>
            <arg value="${package.name}"/>
            <arg value="${applet.name}"/>
            <arg value="${applet.aid.ant}"/>

			<!-- Applet version -->
            <arg value="${version}"/>
        </exec>
    </target>
	
	<!-- Target: Clean up build artifacts -->
	<target name="clean" description="Delete build and output directories to ensure a clean build environment">
		<delete dir="${output.dir}"/>
	</target>
</project>
