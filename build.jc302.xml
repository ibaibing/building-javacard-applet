<?xml version="1.0" encoding="UTF-8"?>
<project name="build-jc302" default="convert" basedir=".">
    
	<import file="build.properties.xml"/>
	<import file="build.dateinfo.xml"/>

	<property name="jdk.java"  value="${jdk11.java}"/>
	<property name="jdk.javac" value="${jdk11.javac}"/>	
	
	<!-- Compile target using exec form -->
    <target name="compile" depends="generate-info-file">
	    <echo message="compile ${jc302.sdk}..." />
		
        <!-- Create output directory -->
        <mkdir dir="${output.dir}/jc302"/>

        <!-- Compile JavaCard source files -->
        <exec executable="${jdk.javac}" failonerror="true">
            <arg value="-source"/><arg value="1.6"/>
            <arg value="-target"/><arg value="1.6"/>
            <arg value="-d"/><arg value="${output.dir}/jc302"/>
            <arg value="-classpath"/>
            <arg value="${jc302.sdk}/lib/api_classic.jar;${output.dir}/jc302;${gpapi.jar}"/>
            <arg value="${src.dir}/${package.name}/*.java"/>
        </exec>
    </target>
	
	<!-- Convert target using exec form -->
    <target name="convert" depends="compile">
	    <echo message="convert ${jc302.sdk}..." />
		
	    <!-- Run JavaCard converter using specific JDK -->
        <exec executable="${jdk.java}" failonerror="true">

			<!-- Set JVM property jc.home -->
			<arg value="-Djc.home=${jc302.sdk}"/>
			
			<!-- Set classpath to include JavaCard converter tool -->
			<arg value="-cp"/>
			<arg value="${jc302.sdk}/lib/tools.jar"/>
			
			<!-- Main class to run -->
			<arg value="com.sun.javacard.converter.Main"/>

			<!-- Specify export path -->
			<arg value="-exportpath"/>
			<arg value="${output.dir}/jc302;${jc302.sdk}/api_export_files;./libs/gpapis/CORE/1.0/exports;./export"/>


			<!-- Output formats -->
            <arg value="-out"/>
            <arg value="JCA"/>
            <arg value="CAP"/>
            <arg value="EXP"/>
			
			<!-- Compiled class files directory -->
            <arg value="-classdir"/>
            <arg value="${output.dir}/jc302"/>

			<!-- Output directory for generated files -->
            <arg value="-d"/>
            <arg value="${output.dir}/jc302"/>
			
			<!-- support int -->
            <arg value="-i"/>
			
			<!-- Applet information -->
            <arg value="-applet"/>
            <arg value="${package.aid.ant}"/>
            <arg value="${package.name}"/>
            <arg value="${applet.name}"/>
            <arg value="${applet.aid.ant}"/>

			<!-- Applet version -->
            <arg value="${version}"/>
        </exec>
    </target>
	
	<!-- Target: Clean up build artifacts -->
	<target name="clean" description="Delete build and output directories to ensure a clean build environment">
		<delete dir="${output.dir}"/>
	</target>
</project>
